<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Pré-fila de Postagens</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; color: #111; }
    h1 { margin: 0 0 12px; font-size: 20px; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin: 16px 0; }
    .row { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    .muted { color: #6b7280; font-size: 13px; }
    .btn { padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f8fafc; cursor: pointer; }
    .btn:active { transform: translateY(1px); }
    code { background: #f3f4f6; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Pré-fila de Postagens</h1>
  <p class="muted">Esta tela é um placeholder para acompanhamento. A geração de mídia/legenda ocorre no serviço de preparo. O robô de postagem lê a Pré-fila e publica nos grupos selecionados.</p>

  <div class="card">
    <div class="row">
      <button class="btn" id="btnStatus">Ver status do robô</button>
      <span id="statusText" class="muted">—</span>
    </div>
    <div class="muted" style="margin-top:8px">
      Janela ativa: <code id="activeHours">—</code> |
      Em janela agora: <code id="inWindow">—</code> |
      Enviados hoje: <code id="sentToday">—</code> |
      Teto diário: <code id="dailyCap">—</code> |
      Restante: <code id="remaining">—</code>
    </div>
  </div>

  <div class="card">
    <strong>Como usar</strong>
    <ol>
      <li>Confirme os <em>grupos selecionados</em> em <a href="/admin/groups" target="_blank">/admin/groups</a>.</li>
      <li>Garanta que os itens “Prontos para enviar” já estejam na sua Pré-fila (serviço de preparo).</li>
      <li>O robô publicará respeitando a <code>POST_ACTIVE_HOURS</code>, os limites diários e pausas.</li>
    </ol>
    <p class="muted">Quando o painel da Pré-fila estiver disponível com lista detalhada, ele aparecerá aqui.</p>
  </div>

  <script>
    async function load() {
      try {
        const r = await fetch('/api/post/status')
        const j = await r.json()
        const S = (id, v) => document.getElementById(id).textContent = v ?? '—'
        if (j && j.ok) {
          S('activeHours', j.activeHours || 'não definida')
          S('inWindow', j.inWindow ? 'sim' : 'não')
          S('sentToday', j.sentToday ?? 0)
          S('dailyCap', j.dailyCap || 0)
          S('remaining', j.remainingToday ?? '—')
          document.getElementById('statusText').textContent = 'Status carregado.'
        } else {
          document.getElementById('statusText').textContent = 'Falha ao obter status.'
        }
      } catch (e) {
        document.getElementById('statusText').textContent = 'Erro de rede.'
      }
    }
    document.getElementById('btnStatus').addEventListener('click', load)
  </script>
</body>
</html>
